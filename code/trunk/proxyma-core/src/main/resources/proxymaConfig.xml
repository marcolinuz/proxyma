<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : proxymaConfig.xml
    Created on : 5 giugno 2010, 11.49
    Author     : Marco Casavecchia Morganti (marcolinuz) [marcolinuz-at-gmail.com]
    Description:
        This is the main configuration file for the proxyma-core package.
-->

<proxyma-configuration>

    <!-- Global settings for every instance of proxyma -->
    <global>
        <!-- Version of this release of the proxyma-core engine -->
        <version>1.0-alpha</version>

       <!-- Specify the default encoding charset to use -->
       <defaultEncoding>UTF-8</defaultEncoding>

       <!-- Byte Buffer implementation for the resource data store.
            There are 3 different types of this:
            m.c.m.proxyma.buffers.RamBuffer -> It stores only small objects into RAM.
            m.c.m.proxyma.buffers.FileBuffer -> It can store objects of any size,
                                                the data are saved into temporary files.
            m.c.m.proxyma.buffers.SmartBuffer -> It can store objects of any size,
                                                 if the object are small they're
                                                 stored in RAM, else it uses a
                                                 FileBuffer to store data into
                                                 temporary files. -->
        <byteBufferImplementation>m.c.m.proxyma.buffers.SmartBuffer</byteBufferImplementation>

        <!-- It enabled (true) a list of the registered proxy folders will be
             generated if the client requests the proxyma root URI -->
        <showProxyFoldersOnRootPath>true</showProxyFoldersOnRootPath>

        <!-- Logging policy -->
        <logging>
            <!-- Log level.. set this to INFO in Production Environments
             Valid values: SEVERE, WARNING, INFO, CONFIG, FINE, FINER, FINEST, ALL -->
            <level>INFO</level>

            <!-- Log file prefix will be used to compose the name of proxyma log file.
             The file name will be composed as: "<logFilePrefix>-<contextName>.log" -->
            <filePrefix>/tmp/proxyma</filePrefix>

            <!-- Max number of lines for one log file -->
            <maxLinesPerFile>500000</maxLinesPerFile>

            <!-- Max number of log files to keep -->
            <retention>5</retention>
        </logging>
    </global>
    
        <!-- This element defines the settings for the new ProxyFolders 
         created by the ProxymaFacade.. -->
    <defaultContext>
        <!-- These are the default settings that ProxymaFaceda will apply to
             the any new ProxyFolder that it creates -->
        <folderSettings>
            <maxPostSize>5000</maxPostSize>
            <enabled>true</enabled>
            <preprocessors>
                <resourceHandler/>
            </preprocessors>
            <cacheProvider>m.c.m.proxyma.plugins.caches.EhcacheCacheProvider</cacheProvider>
            <retriver>m.c.m.proxyma.plugins.retrivers.SimpleHttpRetriver</retriver>
            <transformers>
                <resourceHandler>m.c.m.proxyma.plugins.transformers.HtmlUrlRewriter</resourceHandler>
                <resourceHandler>m.c.m.proxyma.plugins.transformers.CssUriRewriter</resourceHandler>
                <resourceHandler>m.c.m.proxyma.plugins.transformers.HttpCookiesRevriter</resourceHandler>
                <resourceHandler>m.c.m.proxyma.plugins.transformers.HttpRedirectRewriter</resourceHandler>
            </transformers>
            <serializer>m.c.m.proxyma.plugins.serializers.SimpleSerializer</serializer>
        </folderSettings>
    </defaultContext>

    <!-- The following is a list of plugins that comes with the
         standard release of Proxyma. You can add to these lists
         your own plugins.. you only have to implement them using
         the proper interface. ;O)
         NOTE: Plugins are applyed into the folders in registration order -->
    <plugins>
        <!-- List of chache Providers that can be used by proxyma core engine
             These plugins implements the "CacheProvider" interface -->
        <avaliableCacheProviders>
            <cacheProvider>m.c.m.proxyma.plugins.caches.NullCacheProvider</cacheProvider>
            <cacheProvider>m.c.m.proxyma.plugins.caches.EhcacheCacheProvider</cacheProvider>
        </avaliableCacheProviders>

        <!-- List of Preprocessor plugins that can be used by the proxyma engine.
             NOTE: these plugins extends the "AbstractPreprocessor" class overriding
             the "process" method. -->
        <avaliablePreprocessors>
            <resourceHandler>m.c.m.proxyma.plugins.preprocessors.PerformanceTestPreprocessor</resourceHandler>
        </avaliablePreprocessors>

        <!-- List of Transformer plugins that can be used by the proxyma engine
             NOTE: these plugins extends the "AbstractTransformer" class overriding
             the "process" method. -->
        <avaliableTransformers>
            <resourceHandler>m.c.m.proxyma.plugins.transformers.HttpRedirectRewriter</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.transformers.HttpCookiesRevriter</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.transformers.HtmlUrlRewriter</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.transformers.CssUrlRewriter</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.transformers.HtmlEmbedJSRewriter</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.transformers.JSLibraryRewriter</resourceHandler>
        </avaliableTransformers>

        <!-- List of Serializer plugins that can be used by the proxyma engine.
             NOTE: these plugins extends the "AbstractSerializer" class overriding
             the "process" method. -->
        <availableSerializers>
            <resourceHandler>m.c.m.proxyma.plugins.serializers.SimpleSerializer</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.serializers.DebugSerializer</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.serializers.PerformanceTestSerializer</resourceHandler>
        </availableSerializers>

        <!-- List of Retriver plugins that can be used by the proxyma engine.
             NOTE: these plugins extends the "AbstractRetriver" class overriding
             the "process" method. -->
        <availableRetrivers>
            <resourceHandler>m.c.m.proxyma.plugins.retrivers.TestPageRetriver</resourceHandler>
            <resourceHandler>m.c.m.proxyma.plugins.retrivers.SimpleHttpRetriver</resourceHandler>
        </availableRetrivers>
    </plugins>

    <!-- Plugins specific configurations.
         This element is here to define custom configurations needed by some
         plugins. (for example your own.. :O).
         Configuration data in nested into this element can be obtained from the
         ProxymaContext using the XPath of them with the "getSingleValueParameter"
         and "getMultiValueParameter" methods.
         PS: See the EcacheCacheProvider implementation to better understand
             how to use this section. -->
    <plugins-specific>      
        <!-- Specific configuration for the ehcache plugin -->
        <plugin name="m.c.m.proxyma.plugins.caches.EhcacheCacheProvider">

        </plugin>
        
        <!-- Specific configuration for the Simple Serializer plugin -->
        <plugin name="m.c.m.proxyma.plugins.serializers.SimpleSerializer">
            <!-- Log file prefix will be used to compose the name of the access-log file.
             The file name will be composed as: "<logFilePrefix>-<contextName>-access.log" -->
            <filePrefix>/tmp/proxyma</filePrefix>

            <!-- Max number of lines for one access-log file -->
            <maxLinesPerFile>5000000</maxLinesPerFile>

            <!-- Max number of access-log files to keep -->
            <retention>5</retention>
        </plugin>
    </plugins-specific>
</proxyma-configuration>
